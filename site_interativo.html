<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Interativo SSRI-PRAD</title>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1a472a 0%, #2d5f3f 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
        }
        .header-logo {
            max-width: 120px;
            height: auto;
        }
        .header-title-section {
            flex: 1;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        .header-responsible {
            font-size: 0.95em;
            opacity: 0.85;
            font-weight: 500;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 15px;
            margin-top: 15px;
        }
        .responsible-name {
            font-weight: 700;
            font-size: 1em;
            opacity: 1;
        }
        .content {
            padding: 40px;
        }
        .controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .control-group label {
            font-weight: 600;
            color: #1a472a;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        select, input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #f59e0b;
        }
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .kpi-card.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .kpi-card.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .kpi-card.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .kpi-value {
            font-size: 2.5em;
            font-weight: 800;
            margin: 10px 0;
        }
        .kpi-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        .chart-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .chart-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1a472a;
            margin-bottom: 20px;
            text-align: center;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .footer {
            background: #f8f9fa;
            padding: 20px 40px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #e0e0e0;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <img src="logo_seriemas.png" alt="Logo Cons√≥rcio SERIEMAS" class="header-logo">
                <div class="header-title-section">
                    <h1>Dashboard Interativo SSRI-PRAD</h1>
                    <p>An√°lise de Evolu√ß√£o e Indicadores de Desempenho em Tempo Real</p>
                </div>
            </div>
            <div class="header-responsible">
                Respons√°vel pelo Planejamento e Execu√ß√£o:<br>
                <span class="responsible-name">Jessica Godoy</span> - Coordenadora de Meio Ambiente
            </div>
        </div>

        <div class="content">
            <div class="controls">
                <div class="control-group">
                    <label for="tipo-filter">Filtrar por Tipo de Atividade:</label>
                    <select id="tipo-filter" onchange="atualizarDashboard()">
                        <option value="">TODOS OS TIPOS</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="status-filter">Filtrar por Status:</label>
                    <select id="status-filter" onchange="atualizarDashboard()">
                        <option value="">TODOS OS STATUS</option>
                        <option value="Conclu√≠da">Conclu√≠da</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Em Atraso">Em Atraso</option>
                        <option value="N√£o Iniciada">N√£o Iniciada</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="ordenacao">Ordenar por:</label>
                    <select id="ordenacao" onchange="atualizarDashboard()">
                        <option value="percentual">Percentual Conclu√≠do</option>
                        <option value="prazo">Desempenho de Prazo</option>
                        <option value="nome">Nome da Atividade</option>
                    </select>
                </div>
            </div>

            <div class="kpi-section" id="kpi-section">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando indicadores...</p>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Evolu√ß√£o por Atividade</div>
                    <div class="chart-wrapper" id="chart-evolucao"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Distribui√ß√£o de Status</div>
                    <div class="chart-wrapper" id="chart-status"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Produtividade por Tipo de Atividade</div>
                    <div class="chart-wrapper" id="chart-produtividade"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Cronograma do Projeto</div>
                    <div class="chart-wrapper" id="chart-cronograma"></div>
                </div>

                <div class="chart-container full-width">
                    <div class="chart-title">Desempenho de Prazo por Atividade</div>
                    <div class="chart-wrapper" id="chart-prazo"></div>
                </div>
            </div>
        </div>

        <div class="summary-section">
            <div class="summary-title">üìä Resumo Executivo da An√°lise</div>
            
            <div class="summary-grid">
                <div class="summary-box success">
                    <div class="summary-box-title">‚úì Pontos Positivos</div>
                    <div class="summary-box-content">
                        <strong>CONTROLE DE EROS√ÉO</strong> lidera com <strong>53.16%</strong> de conclus√£o, demonstrando execu√ß√£o forte e consistente. As atividades iniciadas apresentam progresso <strong>13 dias adiantadas</strong> em rela√ß√£o ao planejado, indicando efici√™ncia operacional.
                    </div>
                </div>
                
                <div class="summary-box warning">
                    <div class="summary-box-title">‚ö† √Åreas de Aten√ß√£o</div>
                    <div class="summary-box-content">
                        <strong>SEMEADURA</strong> est√° em apenas <strong>7.03%</strong> de conclus√£o, representando o principal gargalo do projeto. <strong>TOPSOIL</strong> em <strong>25.44%</strong> tamb√©m requer acelera√ß√£o. Estas atividades s√£o cr√≠ticas para o cronograma geral.
                    </div>
                </div>
                
                <div class="summary-box">
                    <div class="summary-box-title">üìà Indicadores de Desempenho</div>
                    <div class="summary-box-content">
                        <strong>√çndice de Sa√∫de: 23.95%</strong> - Projeto em fase inicial com oportunidades de acelera√ß√£o. <strong>Taxa de Risco: 2.13%</strong> - Apenas 1 atividade em atraso cr√≠tico, indicando bom controle geral. <strong>Velocidade: 70.51%</strong> - Execu√ß√£o a 70% da velocidade planejada.
                    </div>
                </div>
                
                <div class="summary-box danger">
                    <div class="summary-box-title">üî¥ A√ß√µes Imediatas</div>
                    <div class="summary-box-content">
                        Priorizar retomada da <strong>atividade em atraso cr√≠tico</strong> para evitar efeito domin√≥. Aumentar recursos no segmento <strong>SEMEADURA</strong> para atingir meta de <strong>25%</strong> at√© pr√≥xima revis√£o. Implementar monitoramento semanal de KPIs.
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Dashboard Interativo SSRI-PRAD | √öltima atualiza√ß√£o: <span id="data-atualizacao">--</span></p>
        </div>
    </div>

    <script>
        let dadosCompletos = {};
        let dadosFiltrados = {};



        function renderizarCronograma() {
            // Calcular datas do projeto
            const dataInicio = new Date(2025, 8, 8); // 08/09/2025 // 08/09/2025
            const dataConclusao = new Date(2026, 6, 26); // 26/07/2026 // 20/05/2026
            const dataHoje = new Date();
            
            // Calcular duracao total em dias
            const duracaoTotal = Math.floor((dataConclusao - dataInicio) / (1000 * 60 * 60 * 24));
            const diasDecorridos = Math.floor((dataHoje - dataInicio) / (1000 * 60 * 60 * 24));
            const diasRestantes = Math.max(0, duracaoTotal - diasDecorridos);
            
            // Calcular progresso percentual
            const progressoPercentual = Math.min(100, Math.max(0, (diasDecorridos / duracaoTotal) * 100));
            
            // Formatar datas
            const formatarData = (data) => {
                const dia = String(data.getDate()).padStart(2, '0');
                const mes = String(data.getMonth() + 1).padStart(2, '0');
                const ano = data.getFullYear();
                return dia + '/' + mes + '/' + ano;
            };
            
            // Criar gr√°fico de indicador (gauge)
            const trace = {
                type: "indicator",
                mode: "gauge+number+delta",
                value: progressoPercentual,
                title: { text: "Progresso do Projeto" },
                delta: { reference: 50 },
                gauge: {
                    axis: { range: [0, 100] },
                    bar: { color: "#10b981" },
                    steps: [
                        { range: [0, 25], color: "#fee2e2" },
                        { range: [25, 50], color: "#fecaca" },
                        { range: [50, 75], color: "#fbbf24" },
                        { range: [75, 100], color: "#86efac" }
                    ],
                    threshold: {
                        line: { color: "red", width: 4 },
                        thickness: 0.75,
                        value: 90
                    }
                }
            };
            
            const layout = {
                margin: { l: 50, r: 50, t: 50, b: 50 },
                height: 400,
                font: { color: "#1a472a", family: "Segoe UI" }
            };
            
            Plotly.newPlot('chart-cronograma', [trace], layout, { responsive: true });
            
            // Exibir informa√ß√µes adicionais no console ou em um elemento adicional
            console.log('Data de Inicio: ' + formatarData(dataInicio));
            console.log('Data de Conclusao: ' + formatarData(dataConclusao));
            console.log('Dias Decorridos: ' + Math.max(0, diasDecorridos));
            console.log('Dias Restantes: ' + diasRestantes);
            console.log('Duracao Total: ' + duracaoTotal + ' dias');
        }

        async function carregarDados() {
            try {
                const response = await fetch('dados_site_interativo.json?t=1763498055');
                dadosCompletos = await response.json();
                
document.getElementById('data-atualizacao').textContent = dadosCompletos.data_atualizacao;
                

                
                popularFiltros();
                renderizarKPIs();
                atualizarDashboard();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                document.querySelector('.content').innerHTML = '<div class="loading"><p>Erro ao carregar dados. Verifique se o arquivo dados_site_interativo.json est√° dispon√≠vel.</p></div>';
            }
        }

        function popularFiltros() {
            const tiposUnicos = [...new Set(dadosCompletos.atividades.map(a => a.tipo))].sort();
            const selectTipo = document.getElementById('tipo-filter');
            
            tiposUnicos.forEach(tipo => {
                const option = document.createElement('option');
                option.value = tipo;
                option.textContent = tipo;
                selectTipo.appendChild(option);
            });
        }

        function filtrarDados() {
            const tipoSelecionado = document.getElementById('tipo-filter').value;
            const statusSelecionado = document.getElementById('status-filter').value;
            
            dadosFiltrados = dadosCompletos.atividades.filter(atividade => {
                const passaTipo = !tipoSelecionado || atividade.tipo === tipoSelecionado;
                const passaStatus = !statusSelecionado || atividade.status === statusSelecionado;
                return passaTipo && passaStatus;
            });
        }

        function ordenarDados() {
            const ordenacao = document.getElementById('ordenacao').value;
            
            switch(ordenacao) {
                case 'percentual':
                    dadosFiltrados.sort((a, b) => b.percentual_concluido - a.percentual_concluido);
                    break;
                case 'prazo':
                    dadosFiltrados.sort((a, b) => b.desempenho_prazo_dias - a.desempenho_prazo_dias);
                    break;
                case 'nome':
                    dadosFiltrados.sort((a, b) => a.atividade.localeCompare(b.atividade));
                    break;
            }
        }

        function renderizarKPIs() {
            const kpi = dadosCompletos.indicadores_chave;
            const kpiSection = document.getElementById('kpi-section');
            
            const kpis = [
                { label: '√çndice de Sa√∫de do Projeto', valor: kpi.indice_saude_projeto + '%', classe: kpi.indice_saude_projeto >= 50 ? 'success' : 'warning' },
                { label: 'Taxa de Conclus√£o', valor: kpi.taxa_conclusao_acumulada + '%', classe: 'success' },
                { label: 'Taxa de Risco', valor: kpi.taxa_atividades_risco + '%', classe: kpi.taxa_atividades_risco > 10 ? 'danger' : 'warning' },
                { label: 'Velocidade de Execu√ß√£o', valor: kpi.velocidade_execucao + '%', classe: 'warning' },
                { label: 'Atividades Conclu√≠das', valor: kpi.atividades_concluidas + '/' + kpi.total_atividades, classe: 'success' },
                { label: 'Atividades em Risco', valor: kpi.taxa_atividades_risco + '%', classe: kpi.taxa_atividades_risco > 5 ? 'danger' : 'warning' }
            ];
            
            kpiSection.innerHTML = kpis.map(k => `
                <div class="kpi-card ${k.classe}">
                    <div class="kpi-label">${k.label}</div>
                    <div class="kpi-value">${k.valor}</div>
                </div>
            `).join('');
        }

        function atualizarDashboard() {
            filtrarDados();
            ordenarDados();
            
renderizarEvolucao();
            renderizarStatus();
            renderizarProdutividade();
            renderizarCronograma();
            renderizarPrazo();
        }

        function renderizarEvolucao() {
            const dados = dadosFiltrados.slice(0, 20); // Limitar a 20 para melhor visualiza√ß√£o
            
            const trace = {
                y: dados.map(d => d.atividade.substring(0, 30)),
                x: dados.map(d => d.percentual_concluido),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: dados.map(d => {
                        if (d.percentual_concluido === 100) return '#10b981';
                        if (d.percentual_concluido >= 50) return '#f59e0b';
                        return '#ef4444';
                    })
                },
                text: dados.map(d => d.percentual_concluido + '%'),
                textposition: 'outside'
            };
            
            const layout = {
                margin: { l: 250, r: 50, t: 20, b: 50 },
                xaxis: { range: [0, 100] },
                yaxis: { automargin: true },
                height: 400
            };
            
            Plotly.newPlot('chart-evolucao', [trace], layout, { responsive: true });
        }

        function renderizarStatus() {
            const statusCounts = {};
            dadosFiltrados.forEach(a => {
                statusCounts[a.status] = (statusCounts[a.status] || 0) + 1;
            });
            
            const cores = {
                'Conclu√≠da': '#10b981',
                'Em Andamento': '#667eea',
                'Em Atraso': '#ef4444',
                'Alerta': '#f59e0b',
                'N√£o Iniciada': '#9ca3af',
                'Atrasada (N√£o Iniciada)': '#f59e0b',
                'Atraso Cr√≠tico (N√£o Iniciada)': '#ef4444'
            };
            
            const trace = {
                labels: Object.keys(statusCounts),
                values: Object.values(statusCounts),
                type: 'pie',
                marker: { colors: Object.keys(statusCounts).map(s => cores[s] || '#999') },
                textinfo: 'percent',
                hoverinfo: 'label+value+percent'
            };
            
            const layout = { height: 400 };
            Plotly.newPlot('chart-status', [trace], layout, { responsive: true });
        }

        function renderizarProdutividade() {
            const dados = dadosCompletos.produtividade_por_tipo.sort((a, b) => b.percentual_concluido - a.percentual_concluido);
            
            const trace = {
                x: dados.map(d => d.tipo),
                y: dados.map(d => d.percentual_concluido),
                type: 'bar',
                marker: {
                    color: dados.map(d => {
                        if (d.percentual_concluido >= 50) return '#10b981';
                        if (d.percentual_concluido >= 25) return '#f59e0b';
                        return '#ef4444';
                    })
                },
                text: dados.map(d => d.percentual_concluido.toFixed(1) + '%'),
                textposition: 'outside'
            };
            
            const layout = {
                margin: { b: 100 },
                xaxis: { tickangle: -45 },
                yaxis: { range: [0, 100] },
                height: 400
            };
            
            Plotly.newPlot('chart-produtividade', [trace], layout, { responsive: true });
        }



        function renderizarPrazo() {
            const dados = dadosFiltrados.filter(d => d.desempenho_prazo_dias !== 0).slice(0, 15);
            
            const trace = {
                x: dados.map(d => d.atividade.substring(0, 25)),
                y: dados.map(d => d.desempenho_prazo_dias),
                type: 'bar',
                marker: {
                    color: dados.map(d => d.desempenho_prazo_dias > 0 ? '#ef4444' : '#10b981')
                },
                text: dados.map(d => d.desempenho_prazo_dias.toFixed(0) + ' dias'),
                textposition: 'outside'
            };
            
            const layout = {
                margin: { b: 100 },
                xaxis: { tickangle: -45 },
                yaxis: { title: 'Dias' },
                shapes: [{
                    type: 'line',
                    y0: 0, y1: 0,
                    x0: -0.5, x1: dados.length - 0.5,
                    line: { color: '#1a472a', width: 2 }
                }],
                height: 400
            };
            
            Plotly.newPlot('chart-prazo', [trace], layout, { responsive: true });
        }

        // Inicializar ao carregar a p√°gina
        carregarDados();
    </script>

        <!-- Link para o Gr√°fico de Gantt -->
        <div style="margin-top: 40px; padding: 20px; background-color: #F8FAFC; border-radius: 8px; text-align: center;">
            <h3 style="color: #1A472A; margin-bottom: 15px;">üìä An√°lise Detalhada de Cronograma</h3>
            <p style="color: #4B5563; margin-bottom: 15px;">Visualize o impacto das atividades de SEMEADURA e TOPSOIL no cronograma do projeto</p>
            <a href="gantt_semeadura_topsoil.html" target="_blank" style="
                display: inline-block;
                padding: 12px 30px;
                background-color: #1A472A;
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                transition: background-color 0.3s;
            " onmouseover="this.style.backgroundColor='#0F3620'" onmouseout="this.style.backgroundColor='#1A472A'">
                Abrir Gr√°fico de Gantt
            </a>
        </div>

    </body>
</html>
