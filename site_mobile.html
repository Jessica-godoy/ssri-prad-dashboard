<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>KPI PRAD Mobile - Dashboard Interativo</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1A472A;
            --secondary: #F59E0B;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --light: #F8FAFC;
            --dark: #1E293B;
            --text: #334155;
            --border: #E2E8F0;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body.dark-mode {
            background-color: var(--dark);
            color: #E2E8F0;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #2D5A3D 100%);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 100%;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 18px;
        }

        .header-title {
            font-size: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .header-subtitle {
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* CONTAINER */
        .container {
            max-width: 100%;
            padding: 0.5rem;
            margin: 0 auto;
        }

        /* KPI CARDS */
        .kpi-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        body.dark-mode .kpi-card {
            background: #2D3748;
            color: #E2E8F0;
        }

        .kpi-card:active {
            transform: scale(0.98);
        }

        .kpi-label {
            font-size: 0.7rem;
            color: #64748B;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .kpi-label {
            color: #A0AEC0;
        }

        .kpi-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .kpi-card.success .kpi-value {
            color: var(--success);
        }

        .kpi-card.warning .kpi-value {
            color: var(--warning);
        }

        .kpi-card.danger .kpi-value {
            color: var(--danger);
        }

        .kpi-status {
            font-size: 0.65rem;
            color: #94A3B8;
            margin-top: 0.25rem;
        }

        /* FILTROS */
        .filters {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        body.dark-mode .filters {
            background: #2D3748;
        }

        .filter-group {
            margin-bottom: 0.75rem;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: block;
        }

        select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            cursor: pointer;
            background: white;
            color: var(--text);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        body.dark-mode select {
            background-color: #1A202C;
            color: #E2E8F0;
            border-color: #4A5568;
        }

        /* GR√ÅFICOS */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        body.dark-mode .chart-container {
            background: #2D3748;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .chart-wrapper {
            width: 100%;
            height: 300px;
            position: relative;
        }

        /* RESUMO EXECUTIVO */
        .resumo-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        body.dark-mode .resumo-container {
            background: #2D3748;
        }

        .resumo-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .resumo-section {
            margin-bottom: 1rem;
        }

        .resumo-section:last-child {
            margin-bottom: 0;
        }

        .resumo-subtitle {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .resumo-text {
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--text);
        }

        body.dark-mode .resumo-text {
            color: #CBD5E0;
        }

        /* FOOTER */
        .footer {
            background: var(--primary);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
            font-size: 0.75rem;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem;
            border: none;
            background: white;
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        body.dark-mode .tab-btn {
            background: #2D3748;
            color: #E2E8F0;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        /* RESPONSIVIDADE */
        @media (max-width: 480px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 250px;
            }

            .header-title {
                font-size: 0.9rem;
            }

            .kpi-value {
                font-size: 1.5rem;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 100%;
                padding: 1rem;
            }

            .kpi-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .chart-wrapper {
                height: 400px;
            }
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--primary);
        }

        .spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ERRO */
        .error {
            background: #FEE2E2;
            color: #991B1B;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #DC2626;
        }

        body.dark-mode .error {
            background: #7F1D1D;
            color: #FECACA;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo">üìä</div>
                <div>
                    <div class="header-title">KPI PRAD</div>
                    <div class="header-subtitle">Dashboard Mobile</div>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
    </div>

    <!-- CONTAINER -->
    <div class="container">
        <!-- INFORMA√á√ïES DO RESPONS√ÅVEL -->
        <div style="background: white; border-radius: 12px; padding: 1rem; margin: 1rem 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);" id="responsavel-info">
            <div style="font-size: 0.75rem; color: #64748B; text-transform: uppercase; font-weight: 600; margin-bottom: 0.5rem;">Respons√°vel</div>
            <div style="font-size: 0.95rem; font-weight: 600; color: var(--primary);">Jessica Godoy</div>
            <div style="font-size: 0.8rem; color: #64748B;">Coordenadora de Meio Ambiente</div>
        </div>

        <!-- KPI CARDS -->
        <div class="kpi-grid" id="kpi-cards">
            <div class="loading">
                <div class="spinner"></div>
                <p>Carregando indicadores...</p>
            </div>
        </div>

        <!-- ABAS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('graficos')">üìä Gr√°ficos</button>
            <button class="tab-btn" onclick="showTab('filtros')">üîç Filtros</button>
            <button class="tab-btn" onclick="showTab('resumo')">üìã Resumo</button>
        </div>

        <!-- GR√ÅFICOS -->
        <div id="graficos" class="tab-content">
            <div class="chart-container">
                <div class="chart-title">Evolu√ß√£o por Atividade</div>
                <div class="chart-wrapper" id="chart-evolucao"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Distribui√ß√£o de Status</div>
                <div class="chart-wrapper" id="chart-status"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Produtividade por Tipo</div>
                <div class="chart-wrapper" id="chart-produtividade"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Cronograma do Projeto</div>
                <div class="chart-wrapper" id="chart-cronograma"></div>
            </div>
        </div>

        <!-- FILTROS -->
        <div id="filtros" class="tab-content" style="display: none;">
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Filtrar por Tipo de Atividade</label>
                    <select id="filtro-tipo" onchange="aplicarFiltros()">
                        <option value="">TODOS OS TIPOS</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Filtrar por Status</label>
                    <select id="filtro-status" onchange="aplicarFiltros()">
                        <option value="">TODOS OS STATUS</option>
                        <option value="Conclu√≠da">Conclu√≠da</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Em Atraso">Em Atraso</option>
                        <option value="N√£o Iniciada">N√£o Iniciada</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select id="filtro-ordem" onchange="aplicarFiltros()">
                        <option value="percentual">Percentual Conclu√≠do</option>
                        <option value="prazo">Desempenho de Prazo</option>
                        <option value="nome">Nome da Atividade</option>
                    </select>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Atividades Filtradas</div>
                <div class="chart-wrapper" id="chart-filtrado"></div>
            </div>
        </div>

        <!-- RESUMO EXECUTIVO -->
        <div id="resumo" class="tab-content" style="display: none;">
            <div class="resumo-container">
                <div class="resumo-title">‚úì Pontos Positivos</div>
                <div class="resumo-section">
                    <div class="resumo-text">
                        <strong>CONTROLE DE EROS√ÉO</strong> lidera com <strong>53.16%</strong> de conclus√£o, 
                        demonstrando execu√ß√£o forte e consistente. As atividades iniciadas apresentam progresso 
                        <strong>13 dias adiantadas</strong> em rela√ß√£o ao planejado, indicando efici√™ncia operacional.
                    </div>
                </div>
            </div>

            <div class="resumo-container">
                <div class="resumo-title">‚ö† √Åreas de Aten√ß√£o</div>
                <div class="resumo-section">
                    <div class="resumo-text">
                        <strong>SEMEADURA</strong> est√° em apenas <strong>7.03%</strong> de conclus√£o, 
                        representando o principal gargalo do projeto. <strong>TOPSOIL</strong> em <strong>25.44%</strong> 
                        tamb√©m requer acelera√ß√£o. Estas atividades s√£o cr√≠ticas para o cronograma geral.
                    </div>
                </div>
            </div>

            <div class="resumo-container">
                <div class="resumo-title">üìà Indicadores de Desempenho</div>
                <div class="resumo-section">
                    <div class="resumo-text">
                        <strong>√çndice de Sa√∫de: 23.95%</strong> - Projeto em fase inicial com oportunidades de acelera√ß√£o.<br/>
                        <strong>Taxa de Risco: 2.13%</strong> - Apenas 1 atividade em atraso cr√≠tico, indicando bom controle geral.<br/>
                        <strong>Velocidade: 70.51%</strong> - Execu√ß√£o a 70% da velocidade planejada.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        Dashboard Interativo SSRI-PRAD Mobile | √öltima atualiza√ß√£o: <span id="data-atualizacao">--</span>
    </div>

    <script>
        let dadosGlobais = {};

        // Carregar dados
        async function carregarDados() {
            try {
                const response = await fetch('dados_site_interativo.json');
                if (!response.ok) throw new Error('Erro ao carregar dados');
                dadosGlobais = await response.json();
                renderizarDashboard();
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('kpi-cards').innerHTML = 
                    '<div class="error">Erro ao carregar dados. Verifique se o arquivo dados_site_interativo.json est√° dispon√≠vel.</div>';
            }
        }

        // Renderizar Dashboard
        function renderizarDashboard() {
            renderizarKPIs();
            renderizarGraficos();
            preencherFiltros();
            atualizarDataAtualizacao();
        }

        // Renderizar KPI Cards
        function renderizarKPIs() {
            const kpis = dadosGlobais.indicadores_principais || {};
            const html = `
                <div class="kpi-card success">
                    <div class="kpi-label">√çndice de Sa√∫de</div>
                    <div class="kpi-value">${kpis.indice_saude || 'N/A'}%</div>
                    <div class="kpi-status">Projeto em Andamento</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Taxa de Conclus√£o</div>
                    <div class="kpi-value">${kpis.taxa_conclusao || 'N/A'}%</div>
                    <div class="kpi-status">Atividades Conclu√≠das</div>
                </div>
                <div class="kpi-card warning">
                    <div class="kpi-label">Taxa de Risco</div>
                    <div class="kpi-value">${kpis.taxa_risco || 'N/A'}%</div>
                    <div class="kpi-status">Atividades em Risco</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Velocidade</div>
                    <div class="kpi-value">${kpis.velocidade || 'N/A'}%</div>
                    <div class="kpi-status">Execu√ß√£o Planejada</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Conclu√≠das</div>
                    <div class="kpi-value">${kpis.atividades_concluidas || 'N/A'}</div>
                    <div class="kpi-status">Total de Atividades</div>
                </div>
                <div class="kpi-card warning">
                    <div class="kpi-label">Em Risco</div>
                    <div class="kpi-value">${kpis.atividades_em_risco || 'N/A'}%</div>
                    <div class="kpi-status">Monitorar</div>
                </div>
            `;
            document.getElementById('kpi-cards').innerHTML = html;
        }

        // Renderizar Gr√°ficos
        function renderizarGraficos() {
            const atividades = dadosGlobais.atividades || [];
            const porTipo = dadosGlobais.por_tipo || {};

            // Gr√°fico de Evolu√ß√£o
            if (atividades.length > 0) {
                const nomes = atividades.slice(0, 15).map(a => a.nome.substring(0, 20) + '...');
                const percentuais = atividades.slice(0, 15).map(a => a.percentual_concluido);
                
                Plotly.newPlot('chart-evolucao', [{
                    x: percentuais,
                    y: nomes,
                    type: 'bar',
                    orientation: 'h',
                    marker: { color: '#10B981' }
                }], {
                    margin: { l: 150, r: 20, t: 20, b: 20 },
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent',
                    xaxis: { showgrid: false },
                    yaxis: { automargin: true }
                }, { responsive: true });
            }

            // Gr√°fico de Status
            const statusData = dadosGlobais.status_distribuicao || {};
            const statusLabels = Object.keys(statusData);
            const statusValues = Object.values(statusData);

            if (statusLabels.length > 0) {
                Plotly.newPlot('chart-status', [{
                    labels: statusLabels,
                    values: statusValues,
                    type: 'pie',
                    marker: { colors: ['#10B981', '#F59E0B', '#EF4444', '#94A3B8'] }
                }], {
                    margin: { l: 0, r: 0, t: 0, b: 0 },
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent'
                }, { responsive: true });
            }

            // Gr√°fico de Produtividade
            const tipos = Object.keys(porTipo);
            const produtividades = tipos.map(t => porTipo[t].percentual_conclusao || 0);

            if (tipos.length > 0) {
                Plotly.newPlot('chart-produtividade', [{
                    x: tipos,
                    y: produtividades,
                    type: 'bar',
                    marker: { color: '#F59E0B' }
                }], {
                    margin: { l: 40, r: 20, t: 20, b: 40 },
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent',
                    xaxis: { tickangle: -45 },
                    yaxis: { showgrid: false }
                }, { responsive: true });
            }

            // Gr√°fico de Cronograma (Gauge)
            const indice = dadosGlobais.indicadores_principais?.indice_saude || 0;
            Plotly.newPlot('chart-cronograma', [{
                type: 'indicator',
                mode: 'gauge+number+delta',
                value: indice,
                title: { text: 'Progresso do Projeto' },
                delta: { reference: 50 },
                gauge: {
                    axis: { range: [0, 100] },
                    bar: { color: '#10B981' },
                    steps: [
                        { range: [0, 25], color: '#FEE2E2' },
                        { range: [25, 50], color: '#FEF3C7' },
                        { range: [50, 75], color: '#D1FAE5' },
                        { range: [75, 100], color: '#DCFCE7' }
                    ],
                    threshold: {
                        line: { color: 'red', width: 4 },
                        thickness: 0.75,
                        value: 90
                    }
                }
            }], {
                margin: { l: 0, r: 0, t: 30, b: 0 },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent'
            }, { responsive: true });
        }

        // Preencher Filtros
        function preencherFiltros() {
            const tipos = Object.keys(dadosGlobais.por_tipo || {});
            const select = document.getElementById('filtro-tipo');
            tipos.forEach(tipo => {
                const option = document.createElement('option');
                option.value = tipo;
                option.textContent = tipo;
                select.appendChild(option);
            });
        }

        // Aplicar Filtros
        function aplicarFiltros() {
            const tipo = document.getElementById('filtro-tipo').value;
            const status = document.getElementById('filtro-status').value;
            const ordem = document.getElementById('filtro-ordem').value;

            let atividades = dadosGlobais.atividades || [];

            if (tipo) {
                atividades = atividades.filter(a => a.tipo === tipo);
            }

            if (status) {
                atividades = atividades.filter(a => a.status === status);
            }

            if (ordem === 'percentual') {
                atividades.sort((a, b) => b.percentual_concluido - a.percentual_concluido);
            } else if (ordem === 'prazo') {
                atividades.sort((a, b) => a.desempenho_prazo - b.desempenho_prazo);
            } else {
                atividades.sort((a, b) => a.nome.localeCompare(b.nome));
            }

            const nomes = atividades.slice(0, 10).map(a => a.nome.substring(0, 20) + '...');
            const percentuais = atividades.slice(0, 10).map(a => a.percentual_concluido);

            Plotly.newPlot('chart-filtrado', [{
                x: percentuais,
                y: nomes,
                type: 'bar',
                orientation: 'h',
                marker: { color: '#F59E0B' }
            }], {
                margin: { l: 150, r: 20, t: 20, b: 20 },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                xaxis: { showgrid: false },
                yaxis: { automargin: true }
            }, { responsive: true });
        }

        // Mostrar Aba
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            event.target.classList.add('active');
        }

        // Toggle Tema
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.theme-toggle');
            btn.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Atualizar Data
        function atualizarDataAtualizacao() {
            const data = dadosGlobais.data_atualizacao || new Date().toLocaleString('pt-BR');
            document.getElementById('data-atualizacao').textContent = data;
        }

        // Restaurar Tema
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
        }

        // Carregar dados ao iniciar
        carregarDados();

        // Recarregar a cada 5 minutos
        setInterval(carregarDados, 300000);
    </script>
</body>
</html>
